{% extends "base.html" %}
{% block title %}Evaluate Intern — Industry Supervisor{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-12 col-lg-9">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-start gap-2">
        <div>
          <div class="fw-bold">Site Supervisor’s Evaluation</div>
          <div class="text-muted small">
            Student: <span class="fw-semibold text-dark">{{ placement.request.student.reg_no }}</span>
            — {{ placement.request.student.user.display_name }}
          </div>
          <div class="text-muted small">
            Company: <span class="fw-semibold text-dark">{{ placement.company.name }}</span>
          </div>
        </div>

        <span class="badge text-bg-light border">
          {% if evaluation.status == "draft" %}Draft{% else %}Submitted{% endif %}
        </span>
      </div>

      <div class="card-body">
        <div class="alert alert-light border small mb-3">
            <div class="fw-semibold mb-1">
                <i class="bi bi-info-circle me-1"></i> About this evaluation
            </div>

                <div class="text-muted" style="white-space: pre-line;">
                    The purpose of this evaluation is to help students on internship to further develop their job performance.
                    You are encouraged to discuss your responses with the student in a positive and objective manner, just as you would review job performance with your colleagues.
                    This evaluation will assist in determining the student’s grade.
                    Your assessment of the student’s learning experience, the attainment of goals, and the professional development achieved over the service period is valued.
                </div>

                <hr class="my-2">

                <div>
                    Please grade the Intern with marks from <b>1</b> to <b>5</b> (5 = highest, 1 = lowest).
                </div>
            </div>


        {% if form.errors %}
          <div class="alert alert-danger">
            Please fix the highlighted errors.
          </div>
        {% endif %}

        <form method="post" novalidate>
          {% csrf_token %}

          {# ✅ Render rating rows from `criteria` passed by the view #}
          {% for field, label, comment_field in criteria %}
            <div class="border rounded-4 p-3 mb-3 bg-white">
              <div class="fw-semibold mb-2">{{ label }}</div>

              <div class="d-flex flex-wrap gap-3 align-items-center">
                {% for r in field %}
                  <label class="form-check form-check-inline mb-0">
                    {{ r.tag }}
                    <span class="ms-1">{{ r.choice_label }}</span>
                  </label>
                {% endfor %}
              </div>
              {% if field.errors %}<div class="text-danger small mt-1">{{ field.errors }}</div>{% endif %}

              <div class="mt-2">
                <div class="small text-muted mb-1">Comment (optional)</div>
                {{ comment_field }}
                {% if comment_field.errors %}<div class="text-danger small mt-1">{{ comment_field.errors }}</div>{% endif %}
              </div>
            </div>
          {% endfor %}

          <div class="border rounded-4 p-3 bg-white mb-3">
            <div class="fw-semibold mb-2">Would you recommend this student for employment?</div>
            <div class="mb-2">{{ form.recommend_employment }}</div>
            <div class="small text-muted mb-1">Comment</div>
            {{ form.recommend_comment }}
            {% if form.recommend_employment.errors %}<div class="text-danger small mt-1">{{ form.recommend_employment.errors }}</div>{% endif %}
            {% if form.recommend_comment.errors %}<div class="text-danger small mt-1">{{ form.recommend_comment.errors }}</div>{% endif %}
          </div>

          <div class="border rounded-4 p-3 bg-white mb-3">
            <div class="fw-semibold mb-2">Any other comments / suggestions</div>
            {{ form.other_comments }}
            {% if form.other_comments.errors %}<div class="text-danger small mt-1">{{ form.other_comments.errors }}</div>{% endif %}
          </div>

          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label fw-semibold">Supervisor’s Name</label>
              {{ form.supervisor_name }}
              {% if form.supervisor_name.errors %}<div class="text-danger small mt-1">{{ form.supervisor_name.errors }}</div>{% endif %}
            </div>

            <div class="col-12 col-md-6">
              <label class="form-label fw-semibold">Supervisor’s Signature (type name)</label>
              {{ form.supervisor_signature }}
              {% if form.supervisor_signature.errors %}<div class="text-danger small mt-1">{{ form.supervisor_signature.errors }}</div>{% endif %}
            </div>
          </div>

          <div class="d-flex flex-column flex-md-row gap-2 mt-4">
            <button class="btn btn-outline-secondary" name="action" value="save" type="submit">
              Save Draft
            </button>
            <button class="btn btn-success" name="action" value="submit" type="submit">
              Submit Evaluation
            </button>

            <a class="btn btn-light border ms-md-auto" href="{% url 'company_pending_logs' %}">
              Back
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-3">
    <div class="card">
      <div class="card-header fw-bold"><i class="bi bi-info-circle me-1"></i> Key</div>
      <div class="card-body small text-muted">
        <ul class="mb-0">
          <li>1 = Unsatisfactory</li>
          <li>2 = Below average</li>
          <li>3 = Average / Good</li>
          <li>4 = Very good</li>
          <li>5 = Excellent</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
