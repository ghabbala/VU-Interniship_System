{% extends "base.html" %}
{% block title %}Results Report — University Supervisor{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-12">
    <div class="d-flex flex-column flex-md-row justify-content-between gap-2 align-items-start align-items-md-center">
      <div>
        <div class="fw-bold fs-5">Internship Results Report</div>
        <div class="text-muted small">Average = (Industry /100 + Academic /100) ÷ 2</div>
      </div>

      <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'supervisor_students' %}">
          <i class="bi bi-people me-1"></i> Back to Students
        </a>

        <a class="btn btn-outline-danger btn-sm" href="{% url 'supervisor_results_report_pdf' %}">
          <i class="bi bi-filetype-pdf me-1"></i> Download PDF
        </a>

        <form method="post" action="{% url 'supervisor_submit_results_report' %}">
          {% csrf_token %}
          <button class="btn btn-success btn-sm" type="submit">
            <i class="bi bi-send-check me-1"></i> Submit to Coordinator
          </button>
        </form>
      </div>
    </div>

    <div class="card mt-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span class="fw-bold"><i class="bi bi-clipboard-data me-1"></i> Results</span>
        <span class="badge text-bg-light border">{{ count }} students</span>
      </div>

      <div class="card-body">
        {% if rows %}
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Reg No</th>
                  <th>Student</th>
                  <th>Company</th>
                  <th class="text-end">Industry /100</th>
                  <th class="text-end">Academic /100</th>
                  <th class="text-end">Average /100</th>
                </tr>
              </thead>
              <tbody>
                {% for r in rows %}
                  <tr>
                    <td class="fw-semibold">{{ r.reg_no }}</td>
                    <td>{{ r.name }}</td>
                    <td class="text-muted small">{{ r.company }}</td>

                    <td class="text-end">
                      {% if r.industry_100 is not None %}
                        <span class="badge text-bg-success">{{ r.industry_100|floatformat:0 }}</span>
                      {% else %}—{% endif %}
                    </td>

                    <td class="text-end">
                      {% if r.academic_100 is not None %}
                        <span class="badge text-bg-primary">{{ r.academic_100|floatformat:0 }}</span>
                      {% else %}—{% endif %}
                    </td>

                    <td class="text-end">
                      {% if r.average_100 is not None %}
                        <span class="badge text-bg-dark">{{ r.average_100|floatformat:0 }}</span>
                      {% else %}—{% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-center py-5">
            <i class="bi bi-inbox text-danger" style="font-size:2rem;"></i>
            <div class="fw-bold mt-2">No results found</div>
            <div class="text-muted small">Once evaluations are submitted, they will appear here.</div>
          </div>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}
