{% extends "base.html" %}

{% block title %}Coordinator — Requests Queue{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-12">

    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-2 mb-3">
      <div>
        <div class="fw-bold fs-5">Coordinator — Requests Queue</div>
        <div class="text-muted small">
          Review submitted requests and issue recommendation letters.
        </div>
      </div>

      <div class="d-flex gap-2">
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'coordinator_acceptance_queue' %}">
          <i class="bi bi-patch-check me-1"></i> Acceptance Queue
        </a>
      </div>
    </div>

    <div class="card">
      <div class="card-header d-flex align-items-center justify-content-between">
        <span class="fw-bold"><i class="bi bi-inbox me-1"></i> Pending Requests</span>
        <span class="badge text-bg-light border">
          {{ requests|length }} total
        </span>
      </div>

      <div class="card-body">
        {% if requests %}
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Student</th>
                  <th>Period</th>
                  <th>Status</th>
                  <th>Company</th>
                  <th class="text-end">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for r in requests %}
                  <tr>
                    <td>
                      <div class="fw-semibold">
                        <i class="bi bi-person-badge text-danger me-1"></i>
                        {{ r.student.reg_no }}
                      </div>
                      {% if r.student.user.email %}
                        <div class="small text-muted">{{ r.student.user.display_name }}</div>
                      {% endif %}
                    </td>

                    <td>
                      <span class="fw-semibold">{{ r.period.name }}</span>
                    </td>

                    <td>
                      {% if r.status == "submitted" %}
                        <span class="badge text-bg-primary">Submitted</span>
                      {% elif r.status == "draft" %}
                        <span class="badge text-bg-secondary">Draft</span>
                      {% elif r.status == "recommended" %}
                        <span class="badge text-bg-warning">Recommended</span>
                      {% else %}
                        <span class="badge text-bg-dark">{{ r.status }}</span>
                      {% endif %}
                    </td>

                    <td>
                      {% if r.preferred_company %}
                        <div class="fw-semibold">{{ r.preferred_company.name }}</div>
                        <div class="small text-muted">Preferred company</div>
                      {% else %}
                        <div class="fw-semibold">{{ r.proposed_company_name }}</div>
                        <div class="small text-muted">Proposed company</div>
                      {% endif %}
                    </td>

                    <td class="text-end">
                      <div class="d-inline-flex gap-2">
                        {# optional: if you have a review page later, wire it here #}
                        <a class="btn btn-outline-secondary btn-sm"
                           href="{% url 'coordinator_review' r.id %}">
                          <i class="bi bi-eye me-1"></i> Review
                        </a>

                        <a class="btn btn-success btn-sm"
                           href="{% url 'coordinator_issue_recommendation' r.id %}">
                          <i class="bi bi-file-earmark-check me-1"></i> Issue Letter
                        </a>
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-center py-5">
            <div class="mb-2">
              <i class="bi bi-inbox text-danger" style="font-size:2rem;"></i>
            </div>
            <div class="fw-bold">No pending requests</div>
            <div class="text-muted small">
              When students submit internship requests, they will appear here.
            </div>
          </div>
        {% endif %}
      </div>
    </div>

  </div>
</div>
{% endblock %}
